# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Stars
- **–ö—É—Ä—Å**: 2 ‚≠ê = 1 ‚ÇΩ (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ)
- **–†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram WebApp API
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: API –∫–ª—é—á–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Webhook**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### üîß API Endpoints

#### 1. `/api/stars-invoice-bot` - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞
```typescript
POST /api/stars-invoice-bot
{
  "amount_stars": 200,
  "tg_id": 123456789,
  "business_connection_id": "optional"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "link": "https://t.me/your_bot?start=pay_uuid",
  "invoice_id": "uuid",
  "amount": 200,
  "currency": "XTR"
}
```

#### 2. `/api/telegram-webhook` - Webhook –¥–ª—è –±–æ—Ç–∞
```typescript
POST /api/telegram-webhook
// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
// - Callback queries (–∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
// - Successful payments (—É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏)
// - Pre-checkout queries
```

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ `payment_requests`
```sql
CREATE TABLE payment_requests (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  card_id UUID REFERENCES cards(id),
  tg_id BIGINT NOT NULL,
  amount_rub DECIMAL(10,2) NOT NULL,
  amount_stars INTEGER NOT NULL,
  status TEXT DEFAULT 'pending',
  paid_amount_rub DECIMAL(10,2),
  paid_at TIMESTAMP,
  admin_id UUID REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### üîÑ –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥
2. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `/api/stars-invoice-bot`
3. **–ë–æ—Ç** –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç —Å –±–æ—Ç–æ–º
4. **–ë–æ—Ç** —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–≤–æ–π—Å –≤ Telegram
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∑–≤–µ–∑–¥–∞–º–∏
6. **Webhook** –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
7. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
8. **–ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **API –∫–ª—é—á–∏**: –í—Å–µ endpoints –∑–∞—â–∏—â–µ–Ω—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **RLS**: Row Level Security –≤ Supabase
- **Webhook secret**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ webhook

### üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### TelegramStarsModal
- **–ö—É—Ä—Å**: 2 ‚≠ê = 1 ‚ÇΩ
- **–ü—Ä–µ—Å–µ—Ç—ã**: 100, 200, 500, 1000 –∑–≤–µ–∑–¥
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–æ–¥–∞
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: Responsive design

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_BOT_USERNAME=your_bot_username

# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# API Security
API_KEY=your_api_key

# Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TG_WEBHOOK_SECRET=your_webhook_secret
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ username
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook: `https://yourdomain.com/api/telegram-webhook`
4. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã:
   - `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   - `/pay` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥** –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `npm install`
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã** –≤ Supabase (—Å–º. `database_schema.sql`)
5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook** –±–æ—Ç–∞
6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ**: `npm run build && npm start`

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –õ–æ–≥–∏
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- Webhook –∑–∞–ø—Ä–æ—Å—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –¥–µ—Ç–∞–ª—è–º–∏

#### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π
- –°—É–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
- –û—à–∏–±–∫–∏ API

### üîç –û—Ç–ª–∞–¥–∫–∞

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
```bash
curl -X POST https://yourdomain.com/api/telegram-webhook \
  -H "Content-Type: application/json" \
  -d '{"ok": true}'
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ API
```bash
curl -X POST https://yourdomain.com/api/stars-invoice-bot \
  -H "Content-Type: application/json" \
  -d '{"amount_stars": 100, "tg_id": 123456789}'
```

### üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Stars:
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ö—É—Ä—Å**: 2 ‚≠ê = 1 ‚ÇΩ (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ)
**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: API –∫–ª—é—á–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
